<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trip Invitation</title>
    <link
      href="https://cdn.jsdelivr.net/npm/flowbite@4.0.1/dist/flowbite.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/leoanangmh/flexidatepicker@1.1.5/dist/flexidatepicker.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  </head>

  <body class="min-h-screen bg-white text-gray-900">
    <main class="max-w-2xl mx-auto px-6 py-12 space-y-12">

      <p class="text-lg text-gray-700">
        <span class="font-medium text-gray-900">{{ names }}</span>
        invited you to plan a trip.
      </p>

      <!-- Location -->
      {% include "location.html" %}

      <!-- Duration -->
      {% include "duration.html" %}

      <!-- Season -->
      {% include "season.html" %}

      <!-- Dates -->
      {% include "dates.html" %}

    </main>

    <script src="https://cdn.jsdelivr.net/npm/flowbite@4.0.1/dist/flowbite.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flowbite-datepicker@1.3.0/dist/datepicker.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/leoanangmh/flexidatepicker@1.1.5/dist/flexidatepicker.umd.min.js"></script>
    <script>
  document.addEventListener("DOMContentLoaded", () => {
    // 1️⃣ Map seasons to date ranges
    const seasonDates = {
      Winter: generateDates("2025-12-01", "2025-12-31"),
      Spring: generateDates("2025-03-01", "2025-05-31"),
      Summer: generateDates("2025-06-01", "2025-08-31"),
      Fall:   generateDates("2025-09-01", "2025-11-30")
    };

    function generateDates(start, end) {
      let s = new Date(start), e = new Date(end);
      let dates = [];
      while(s <= e) {
        dates.push(s.toISOString().split("T")[0]);
        s.setDate(s.getDate() + 1);
      }
      return dates;
    }

    // 2️⃣ Initialize FlexiDatepicker
    const fp = new FlexiDatepicker("#date-picker", {
      mode: "multiple",
      dateFormat: "yyyy-MM-dd",
      disabledDates: []
    });

    // 3️⃣ Listen for season changes
    const seasonCheckboxes = document.querySelectorAll('input[name="seasons"]');

    function updateDisabledDates() {
      // Collect allowed dates for selected seasons
      const selectedSeasons = Array.from(seasonCheckboxes)
        .filter(cb => cb.checked)
        .map(cb => cb.value);

      let allowedDates = [];
      selectedSeasons.forEach(season => {
        allowedDates = allowedDates.concat(seasonDates[season] || []);
      });

      // Generate all dates in 2025
      const startDate = new Date("2025-01-01");
      const endDate = new Date("2025-12-31");
      let allDates = [];
      for(let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)){
        allDates.push(d.toISOString().split("T")[0]);
      }

      // Disabled dates = all dates NOT in allowedDates
      const disabledDates = allDates.filter(d => !allowedDates.includes(d));
      fp.setDisabledDates(disabledDates);
    }

    seasonCheckboxes.forEach(cb => cb.addEventListener("change", updateDisabledDates));
  });
  </script>
  </body>
</html>
